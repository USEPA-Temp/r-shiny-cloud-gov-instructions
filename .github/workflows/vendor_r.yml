on:
  workflow_dispatch:

jobs:
  download_and_vendor_dependencies:
    runs-on: ubuntu-latest
  
    steps:
    - uses: actions/checkout@v3

    - uses: r-lib/actions/setup-r@v2
      with:
        r-version: '4.2.2' # The R version to download (if necessary) and use.

    - name: Get R dependencies
      run: |
        sed -n -e 's/^.*- name: //p' r.yml | sed -n -e 'H;${x;s/\n/,/g;s/^,//;p;}' | xargs echo packs= >> $GITHUB_ENV

    - name: Download R packages
      run: |
        scripts/download_packages.R vendor_r/src/contrib ${{ env.packs }}
      shell: RScript

    - name: Write Descriptions
      run: write_descriptions.sh vendor_r/src/contrib 